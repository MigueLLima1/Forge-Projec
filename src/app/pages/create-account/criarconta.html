<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Criar Conta - Forge Project</title>
  <!-- Incluindo Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Favicon -->
  <link rel="icon" href="https://placehold.co/32x32/6366f1/white?text=FP" type="image/png">
  <style>
    /* Estilos para garantir que o layout ocupe a altura total da tela */
    html, body {
        height: 100%;
    }
    body {
        display: flex;
        flex-direction: column;
    }
    main {
        flex-grow: 1;
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800">

  <!-- Header Simplificado -->
  <header class="bg-white shadow-md w-full z-10">
    <div class="container mx-auto px-6 py-4 flex justify-between items-center">
      <a href="../main-page/main-page.html" class="text-2xl font-bold text-indigo-600">Forge Project</a>
    </div>
  </header>

  <!-- Conteúdo Principal -->
  <main class="flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-md w-full space-y-8 bg-white p-10 rounded-xl shadow-2xl">
      <div>
        <h2 class="mt-6 text-center text-3xl font-extrabold text-gray-900">
          Crie a sua conta
        </h2>
        <p class="mt-2 text-center text-sm text-gray-600">
          Junte-se à nossa comunidade!
        </p>
      </div>
      <form id="form-cadastro" class="mt-8 space-y-6">
        <div class="rounded-md shadow-sm -space-y-px">
          <div>
            <label for="name" class="sr-only">Nome Completo</label>
            <input id="name" name="name" type="text" required
                   class="appearance-none rounded-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm"
                   placeholder="Nome Completo">
          </div>
          <div>
            <label for="email" class="sr-only">Endereço de email</label>
            <input id="email" name="email" type="email" autocomplete="email" required
                   class="appearance-none rounded-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm"
                   placeholder="Endereço de email">
          </div>
          <div>
            <label for="password" class="sr-only">Senha</label>
            <input id="password" name="password" type="password" autocomplete="new-password" required
                   class="appearance-none rounded-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm"
                   placeholder="Senha (mínimo 8 caracteres)">
          </div>
           <div>
            <label for="confirm-password" class="sr-only">Confirmar Senha</label>
            <input id="confirm-password" name="confirm-password" type="password" autocomplete="new-password" required
                   class="appearance-none rounded-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm"
                   placeholder="Confirmar Senha">
          </div>
           <!-- Campo Tipo de Conta -->
          <div>
            <label for="account-type" class="sr-only">Tipo de Conta</label>
            <select id="account-type" name="account-type" required
                    class="appearance-none rounded-none relative block w-full px-3 py-3 border border-gray-300 bg-white text-gray-500 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm">
              <option value="" disabled selected>Selecione o tipo de conta</option>
              <option value="aluno">Aluno</option>
              <option value="professor">Professor</option>
              <option value="empregador">Empregador</option>
            </select>
          </div>
          <!-- Campos que dependem do tipo de conta (serão mostrados/ocultos via JS) -->
          <div id="student-professor-fields" class="hidden">
              <div>
                <label for="university" class="sr-only">Universidade</label>
                <select id="university" name="university"
                        class="appearance-none rounded-none relative block w-full px-3 py-3 border border-gray-300 bg-white text-gray-500 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm">
                  <option value="" disabled selected>Selecione a Universidade</option>
                  <option value="ceub">CEUB</option>
                  <option value="iesb">IESB</option>
                  <option value="catolica">Católica</option>
                </select>
              </div>
              <div >
                <label for="course" class="sr-only">Curso</label>
                <select id="course" name="course"
                        class="appearance-none rounded-none relative block w-full px-3 py-3 border border-gray-300 bg-white text-gray-500 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm">
                  <option value="" disabled selected>Selecione o Curso</option>
                  <option value="ads">Análise e Desenvolvimento de Sistemas</option>
                  <option value="cc">Ciência da Computação</option>
                  <option value="cd">Ciência de Dados</option>
                  <option value="ec">Engenharia da Computação</option>
                  <option value="es">Engenharia de Software</option>
                </select>
              </div>
          </div>
          <!-- Campo para Empregador -->
          <div id="employer-fields" class="hidden">
             <div>
                <label for="company-name" class="sr-only">Nome da Empresa</label>
                <input id="company-name" name="company-name" type="text"
                       class="appearance-none rounded-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm"
                       placeholder="Nome da Empresa">
              </div>
          </div>
          <div>
            <label for="dob" class="sr-only">Data de Nascimento</label>
            <input id="dob" name="dob" type="date" required
                   class="appearance-none rounded-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm"
                   placeholder="Data de Nascimento">
          </div>
        </div>

        <div>
          <button type="submit"
                  class="group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            Criar Conta
          </button>
        </div>
      </form>
      <div class="text-sm text-center">
        <p class="login-link text-gray-600">
          Já tem uma conta?
          <a href="../login/login.html" class="font-medium text-indigo-600 hover:text-indigo-500">
            Faça login
          </a>
        </p>
      </div>
    </div>
  </main>

  <!-- Footer Simplificado -->
  <footer class="bg-gray-800 text-gray-300 py-8">
    <div class="container mx-auto px-6 text-center">
      <p>&copy; <span id="currentYearFooter"></span> Forge Project. Todos os direitos reservados.</p>
    </div>
  </footer>

  <!-- Script Firebase + Cadastro -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
    import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB382yNW00I3ugHksrz06fIXowrZMjpHrg",
      authDomain: "forge-projectv2.firebaseapp.com",
      projectId: "forge-projectv2",
      storageBucket: "forge-projectv2.appspot.com",
      messagingSenderId: "277144452911",
      appId: "1:277144452911:web:96d68d991a7d2d92db2bda"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const accountTypeSelect = document.getElementById('account-type');
    const studentProfessorFields = document.getElementById('student-professor-fields');
    const employerFields = document.getElementById('employer-fields');

    // Mostra/oculta campos com base no tipo de conta
    accountTypeSelect.addEventListener('change', (e) => {
        const type = e.target.value;
        studentProfessorFields.classList.toggle('hidden', type !== 'aluno' && type !== 'professor');
        employerFields.classList.toggle('hidden', type !== 'empregador');
    });
    
    document.getElementById("form-cadastro").addEventListener("submit", async (e) => {
      e.preventDefault();

      const email = document.getElementById("email").value;
      const senha = document.getElementById("password").value;
      const confirmarSenha = document.getElementById("confirm-password").value;
      const nome = document.getElementById("name").value;
      const dob = document.getElementById("dob").value;
      const tipoDeConta = document.getElementById("account-type").value;

      if (senha !== confirmarSenha) {
          alert("As senhas não coincidem.");
          return;
      }
      
      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, senha);
        const user = userCredential.user;

        // Atualiza o perfil de autenticação do Firebase com o nome
        await updateProfile(user, {
            displayName: nome
        });

        // Prepara os dados para guardar no Firestore
        const userData = {
          nome,
          email,
          tipoDeConta,
          dataNascimento: dob,
          criadoEm: new Date().toISOString()
        };

        // Adiciona campos condicionais
        if (tipoDeConta === 'aluno' || tipoDeConta === 'professor') {
            userData.universidade = document.getElementById("university").value;
            userData.curso = document.getElementById("course").value;
        } else if (tipoDeConta === 'empregador') {
            userData.nomeEmpresa = document.getElementById("company-name").value;
        }

        // Guarda os dados na coleção 'usuarios'
        await setDoc(doc(db, "usuarios", user.uid), userData);

        alert("Utilizador registado com sucesso!");
        e.target.reset();
        window.location.href = "../login/login.html"; // Redireciona para o login
      } catch (error) {
        console.error("Erro ao registar utilizador:", error);
        alert("Erro ao registar: " + error.message);
      }
    });

    document.getElementById('currentYearFooter').textContent = new Date().getFullYear();
  </script>
</body>
</html>
